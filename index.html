<!doctype html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <title>OpenShift Developer Workshop</title>
        <link rel="stylesheet" href="./css/reveal.css">
        <link rel="stylesheet" href="./theme/puzzle.css" id="theme">
        <link rel="stylesheet" href="./css/highlight/zenburn.css">
        <link rel="stylesheet" href="./css/print/paper.css" type="text/css" media="print">

    </head>
    <body>

        <div class="reveal">
            <div class="slides"><section  data-markdown><script type="text/template">

<!--section -->
# OpenShift Developer Workshop

<!-- .slide: class="master01" -->
</script></section><section  data-markdown><script type="text/template">
## Agenda

* Requests and Limits
* Application Monitoring

<!-- .slide: class="master02" -->
</script></section><section  data-markdown><script type="text/template">
# Requests and Limits

<!-- .slide: class="master02" -->
</script></section><section  data-markdown><script type="text/template">
## Pods

A pod is a group of containers which:

* Run on the same node
* Share the same lifecycle
* Share any persistent volumes
* Share the same IP address
</script></section><section  data-markdown><script type="text/template">
<!--section -->
## Container and Pod Requests

* Reserve cpu and/or memory for a container
* Pod requests = sum of container requests
* Are used by the scheduler for pod placement
* Pods are not scheduled if no node can fulfill the requests
</script></section><section  data-markdown><script type="text/template">
## Container and Pod Limits
* Limit cpu and/or memory of a container
* Pod limits = sum of container limits
* Containers which exceed memory limit are killed by OOM killer and subjected to restart policy
* Excessive CPU usage is throttled via cgroups
</script></section><section  data-markdown><script type="text/template">
## Request and Limit Defaults

* No requests/limits: request/limit = limitrange defaults or unlimited
* Request only: limit = limitrange default or unlimited
* Limit only: request = limit
</script></section><section  data-markdown><script type="text/template">
## Quotas

* Are optional
* Configured by cluster admin per project
* Limit number of objects that can be created
* Limit total cpu and memory that can be used
</script></section><section  data-markdown><script type="text/template">
## Limit Ranges

* Are optional
* Configured by cluster admin per project
* Limit cpu and memory pods and containers can use
* Can provide default container request and limit
</script></section><section  data-markdown><script type="text/template">
## Quality of Service

Requests and limits determine quality of service:

* No request and limit: **BestEffort**
* Request < Limit: **Burstable**
* Request = Limit: **Guaranteed**
</script></section><section  data-markdown><script type="text/template">
## Out of Resource Handling

* OpenShift evicts pods till enough memory or disk space has been freed.
* BestEffort pods are killed first, then Burstable pods.
* Guaranteed pods are newer evicted because of other pods.
* Replication controller, if any, starts replacement pods.
</script></section><section  data-markdown><script type="text/template">
## Best Practices

* Set **memory request = limit** for production containers to prevent eviction
* Set **1/2 memory limit <= request < limit** for non-production containers to optimize resource usage
* Set appropriate cpu requests and limits
</script></section><section  data-markdown><script type="text/template">
## Best Practices

<div style="text-align: left"><p>Set process limit based on container limit:</p></div>

* Depends on technology
* E.g. for Java set heap size = 1/2 memory limit
* Quality images already implement this, e.g.: [OpenShift Java Image](https://developers.redhat.com/blog/2017/02/23/getting-started-with-openshift-java-s2i/)

</script></section><section  data-markdown><script type="text/template">
# Application Monitoring

<!-- .slide: class="master02" -->
</script></section><section  data-markdown><script type="text/template">
## Container Health Checks

* **Liveness probe**: Checks whether a container is still running.
* Non-live containers are killed and subjected to their restart policy.
* **Readiness probe**: Checks whether a container is ready to service requests.
* Non-ready containers don't receive traffic.
</script></section><section  data-markdown><script type="text/template">
## Readiness Probes

* If no containers are ready users get a generic application unavailable message.
* Readiness probe implementation depends on application architecture.
* Also see following canary endpoints.
</script></section><section  data-markdown><script type="text/template">
## Probe Types

* **HTTP check**: HTTP request against container, healthy if response code between 200 and 399.
* **Execution check**: Script runs in container, healthy if exit code is 0.
* **TCP socket check**: TCP connection against container socket, healthy if connection successful.
</script></section><section  data-markdown><script type="text/template">
## App Monitoring

* Developer can see current memory and cpu usage in Web Console (metrics)
* JVM console is available with default images and **jolokia** container port
* Zabbix can monitor memory and cpu of containers and alert
* Zabbix can monitor canary endpoints and alert
</script></section><section  data-markdown><script type="text/template">
## Canary Endpoints

* Simple health endpoint
* Performs no business activity
* Checks status and latency of dependencies, e.g. database
</script></section><section  data-markdown><script type="text/template">
## Canary Endpoints

* Returns HTTP 200 when all checks are ok, 503 otherwise
* Other status codes, like 299, may be used to signal warnings
* May be used as readiness probe and for monitoring
</script></section><section  data-markdown><script type="text/template">
## Resources

* [OpenShift Quotas and Limit Ranges](https://docs.openshift.com/container-platform/3.5/dev_guide/compute_resources.html)
* [OpenShift JVM Console](https://docs.openshift.com/container-platform/3.5/architecture/infrastructure_components/web_console.html#jvm-console)
* [OpenShift Application Health](https://docs.openshift.com/container-platform/3.5/dev_guide/application_health.html)
* [OpenShift Image Creation Guidelines](https://docs.openshift.com/container-platform/3.5/creating_images/guidelines.html)
* [Health Endpoint in API Design](http://byterot.blogspot.ch/2014/11/health-endpoint-in-api-design-slippery-rest-api-design-canary-endpoint-hysterix-asp-net-web-api.html)
* [Canary Endpoint Monitoring](http://uniknow.github.io/AgileDev/site/0.1.10-SNAPSHOT/canary-endpoint-monitoring)
</script></section></div>
        </div>

        <script src="./lib/js/head.min.js"></script>
        <script src="./js/reveal.js"></script>

        <script>
            function extend() {
              var target = {};
              for (var i = 0; i < arguments.length; i++) {
                var source = arguments[i];
                for (var key in source) {
                  if (source.hasOwnProperty(key)) {
                    target[key] = source[key];
                  }
                }
              }
              return target;
            }

            // Optional libraries used to extend on reveal.js
            var deps = [
              { src: './lib/js/classList.js', condition: function() { return !document.body.classList; } },
              { src: './plugin/markdown/marked.js', condition: function() { return !!document.querySelector('[data-markdown]'); } },
              { src: './plugin/markdown/markdown.js', condition: function() { return !!document.querySelector('[data-markdown]'); } },
              { src: './plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } },
              { src: './plugin/zoom-js/zoom.js', async: true },
              { src: './plugin/notes/notes.js', async: true },
              { src: './plugin/math/math.js', async: true }
            ];

            // default options to init reveal.js
            var defaultOptions = {
              controls: true,
              progress: true,
              history: true,
              center: true,
              transition: 'default', // none/fade/slide/convex/concave/zoom
              dependencies: deps
            };

            // options from URL query string
            var queryOptions = Reveal.getQueryHash() || {};

            var options = {};
            options = extend(defaultOptions, options, queryOptions);
            Reveal.initialize(options);
        </script>
        
    </body>
</html>
